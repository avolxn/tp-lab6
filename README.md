# Лабораторная работа 6 - Рефакторинг и Code Smells

Рефакторинг модуля обработки заказов `order_processing.py`.

## Найденные проблемы качества (Code Smells)

1. **Long Method** — функция `process_checkout` содержала ~50 строк с разной логикой
2. **Magic Numbers** — числа 0.10, 0.20, 0.21, 200, 100, 50 разбросаны по коду без объяснения
3. **Duplicated Code** — повторяющаяся логика валидации в цикле
4. **Poor Readability** — сложно понять, что делает код, без детального изучения
5. **Mixed Responsibilities** — одна функция занималась парсингом, валидацией, расчётами и формированием ответа

## Применённые рефакторинги

1. **Extract Method** — выделены функции:
   - `validate_request()` — валидация обязательных полей
   - `validate_item()` — валидация отдельного товара
   - `calculate_subtotal()` — подсчёт суммы заказа
   - `calculate_discount()` — расчёт скидки по купону
   - `calculate_tax()` — расчёт налога
   - `generate_order_id()` — генерация ID заказа

2. **Extract Constant** — магические числа вынесены в константы:
   - `TAX_RATE`, `DEFAULT_CURRENCY`
   - `COUPON_SAVE10_RATE`, `COUPON_SAVE20_RATE` и др.

3. **Replace Loop with Pipeline** — цикл подсчёта subtotal заменён на `sum()` с генератором

4. **Simplify Conditional** — упрощена проверка пустого купона через `if not coupon`

5. **Replace Temp with Query** — использование `max(0, ...)` вместо условия

## Что стало лучше

- **Читаемость**: `process_checkout` теперь читается как сценарий из 10 строк
- **Тестируемость**: каждую функцию можно тестировать отдельно
- **Изменяемость**: для изменения ставки налога достаточно поменять одну константу
- **Понятность**: названия функций объясняют, что происходит

## Запуск тестов

```bash
pytest test_order_processing.py -v
```
